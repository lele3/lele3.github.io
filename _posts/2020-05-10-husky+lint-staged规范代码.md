---
title: husky+lint-staged+prettierè§„èŒƒæäº¤ä»£ç 
key: 20200510
tags: å‰ç«¯
---
<center><h1>husky+lint-staged+prettierè§„èŒƒæäº¤ä»£ç </h1></center>

å½“å¤šä¸ªäººç»´æŠ¤åŒä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç»Ÿä¸€çš„ä»£ç è§„åˆ™ï¼Œæ¯ä¸ªäººæŒ‰ç…§æ¯ä¸ªäººçš„ç¼–ç ä¹ æƒ¯å»å†™ä»£ç ï¼Œé‚£å¯¹åæœŸä»£ç ç»´æŠ¤æ¥è¯´å¯èƒ½æ˜¯ç¾éš¾æ€§çš„ï¼Œå³ä½¿é¡¹ç›®ä¸­å¼•å…¥äº†eslintï¼Œæœ‰æ—¶å€™ä¹Ÿä¼šæœ‰äººä¸å»éµå®ˆï¼Œæ‰€ä»¥è¿™æ—¶å€™å°±éœ€è¦ä¸€å¥—è§„èŒƒå¤–åŠ è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œå½“ä»£ç æäº¤åˆ°è¿œç¨‹ä»“åº“ä¹‹å‰ï¼Œå…ˆæŒ‰ç…§æ ‡å‡†è‡ªåŠ¨æ ¼å¼åŒ–ä¸€éï¼Œ ç„¶ååœ¨pushåˆ°è¿œç¨‹ä»“åº“ï¼Œè¿™å°±å®Œæˆäº†ä»£ç æ ¼å¼çš„ç»Ÿä¸€ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±æ¥å¼•å‡ºæˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’huskyã€lint-stagedã€prettierã€‚
<!--more-->


### husky

åœ¨ä»‹ç»huskyä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´ä¸€è¯´gitçš„hookså‡½æ•°ï¼Œhookså‡½æ•°ä¸»è¦ä½œç”¨å°±æ˜¯åœ¨ç‰¹å®šçš„é‡è¦åŠ¨ä½œå‘ç”Ÿæ—¶è§¦å‘çš„åŠ¨è¿‡ï¼Œå®ƒåˆ†ä¸ºå®¢æˆ·ç«¯é’©å­å’ŒæœåŠ¡ç«¯é’©å­ï¼Œæˆ‘ä»¬åœ¨æ­¤åªä»‹ç»å®¢æˆ·ç«¯é’©å­ã€‚

é’©å­éƒ½è¢«å­˜å‚¨åœ¨ Git ç›®å½•ä¸‹çš„ `hooks` å­ç›®å½•ä¸­ã€‚ ä¹Ÿå³ç»å¤§éƒ¨åˆ†é¡¹ç›®ä¸­çš„ `.git/hooks` ã€‚ å½“ä½ ç”¨ `git init` åˆå§‹åŒ–ä¸€ä¸ªæ–°ç‰ˆæœ¬åº“æ—¶ï¼ŒGit é»˜è®¤ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸­æ”¾ç½®ä¸€äº›ç¤ºä¾‹è„šæœ¬ã€‚ è¿™äº›è„šæœ¬é™¤äº†æœ¬èº«å¯ä»¥è¢«è°ƒç”¨å¤–ï¼Œå®ƒä»¬è¿˜é€éœ²äº†è¢«è§¦å‘æ—¶æ‰€ä¼ å…¥çš„å‚æ•°ã€‚ æ‰€æœ‰çš„ç¤ºä¾‹éƒ½æ˜¯ shell è„šæœ¬ï¼Œå…¶ä¸­ä¸€äº›è¿˜æ··æ‚äº† Perl ä»£ç ï¼Œä¸è¿‡ï¼Œä»»ä½•æ­£ç¡®å‘½åçš„å¯æ‰§è¡Œè„šæœ¬éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ â€”â€” ä½ å¯ä»¥ç”¨ Ruby æˆ– Pythonï¼Œæˆ–ä»»ä½•ä½ ç†Ÿæ‚‰çš„è¯­è¨€ç¼–å†™å®ƒä»¬ã€‚ è¿™äº›ç¤ºä¾‹çš„åå­—éƒ½æ˜¯ä»¥ `.sample` ç»“å°¾ï¼Œå¦‚æœä½ æƒ³å¯ç”¨å®ƒä»¬ï¼Œå¾—å…ˆç§»é™¤è¿™ä¸ªåç¼€ã€‚ï¼ˆå‚è€ƒè‡ª[gitæ–‡æ¡£](https://git-scm.com/book/zh/v2/è‡ªå®šä¹‰-Git-Git-é’©å­))

åœ¨æ­¤ï¼Œæˆ‘ä»¬åªä»‹ç»ä¸€ä¸ªé’©å­`pre-commit`,è¯¥é’©å­åœ¨é”®å…¥æäº¤ä¿¡æ¯å‰è¿è¡Œã€‚ å®ƒç”¨äºæ£€æŸ¥å³å°†æäº¤çš„å¿«ç…§ï¼Œä¾‹å¦‚ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ‰€é—æ¼ï¼Œç¡®ä¿æµ‹è¯•è¿è¡Œï¼Œä»¥åŠæ ¸æŸ¥ä»£ç ã€‚ å¦‚æœè¯¥é’©å­ä»¥éé›¶å€¼é€€å‡ºï¼ŒGit å°†æ”¾å¼ƒæ­¤æ¬¡æäº¤ã€‚



ç°åœ¨å¼€å§‹ä»‹ç»æˆ‘ä»¬çš„ä¸»è§’`husky`,è‹±è¯­æ¯”è¾ƒæ£’çš„åŒå­¦ä¸€æ ·å°±èƒ½çœ‹å‡ºè¿™ä¸æ˜¯å“ˆå£«å¥‡ğŸ¶çš„è‹±æ–‡å— woof!, æ²¡é”™ï¼Œä½ çœŸæ£’ï¼ï¼ï¼ `husky`æ˜¯ä¸€ä¸ªnpmåŒ…ï¼Œç”¨äºå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿè§¦å‘`git hooks`å‡½æ•°ï¼Œè€Œä¸ç”¨å»æ›´æ”¹`.git/hooks`ä¸­çš„ä»£ç ï¼Œé¦–å…ˆå®‰è£…

```javascript
npm install husky --save-dev
```

ç„¶ååœ¨`package.json`ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®

```javascript
// package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "npm test",
      "...": "..."
    }
  }
}
```

å¦‚ä¸Šå½“ä½ æ‰§è¡Œ`git commit`çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘ `npm test`å‘½ä»¤



### lint-staged

npmä¸ŠæŸ¥æ‰¾`lint-staged`ï¼Œ å®ƒçš„ä»‹ç»ä¸­ç¬¬ä¸€å¥è¯å°±æ˜¯`Run linters against staged git files and don't let ğŸ’© slip into your code base!`, ç¿»è¯‘è¿‡æ¥å¤§è‡´æ„æ€å°±æ˜¯ å¯¹æš‚å­˜çš„gitæ–‡ä»¶æ‰§è¡Œlintersï¼Œä¸è¦è®©ğŸ’©è¿›å…¥ä½ çš„ä»£ç ï¼Œ è¯´ç™½äº†ï¼Œå°±æ˜¯è¯¥npmåŒ…å¯ä»¥å¯¹ä½ gitæš‚å­˜åŒºçš„ä»£ç ï¼ˆä¹Ÿå°±æ˜¯ä½ git addçš„ä»£ç ï¼‰è¿›è¡Œæ‰«æï¼Œæ‰§è¡Œä½ è‡ªå®šä¹‰å‘½ä»¤

å®‰è£…

```javascript
npm install lint-staged --save-dev
```

ç„¶ååœ¨`package.json`ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`lint-staged.config.js`ã€`.lintstagedrc.js`é…ç½®æ–‡ä»¶ï¼Œæ›´å¤šé…ç½®è¯·è‡ªè¡ŒæŸ¥çœ‹æ–‡æ¡£

```javascript
"lint-staged": {
  "*.{js,jsx}": [
    "prettier --write",   // prettier è‡ªåŠ¨æ ¼å¼è¯æš‚å­˜åŒºä»£ç 
    "eslint --cache --ext .js" // eslint å¯¹æš‚å­˜åŒºä»£ç æ‰§è¡Œeslintæ ¡éªŒï¼Œ å½“æ·»åŠ --cacheæ—¶ï¼Œæ‰§è¡Œå‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ª .eslintcacheï¼Œ è®°å¾—æŠŠå®ƒæ·»åŠ åˆ°.gitignoreä¸­å»
  ]
}
```



### prettier

è¿™ä¸ªnpmåŒ…å¯ä»¥è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­`.prettierrc.js`é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼Œ**æ³¨æ„ï¼š prettieré…ç½®ä¸èƒ½å’Œeslintçš„é…ç½®å†²çª**

```javascript
module.exports = {
  // æ¯è¡Œçš„é•¿åº¦ï¼Œé»˜è®¤80
  printWidth: 80,

  // åˆ¶è¡¨ç¬¦tabçš„å®½åº¦ï¼Œé»˜è®¤å€¼æ˜¯2
  tabWidth: 2,

  // æ˜¯å¦ä½¿ç”¨tabæ¥ä»£æ›¿spacesç¼©è¿›ï¼Œ é»˜è®¤false
  useTabs: false,

  // æ˜¯å¦éœ€è¦åˆ†å·
  semi: true,

  // æ˜¯å¦ä½¿ç”¨å•å¼•å·ä»£æ›¿åŒå¼•å·
  singleQuote: true,

  // å¯¹è±¡å±æ€§çš„å¼•å·ä½¿ç”¨
  // as-needed ä»…åœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨
  // consistent æœ‰ä¸€ä¸ªå±æ€§éœ€è¦å¼•å·ï¼Œå°±éƒ½éœ€è¦å¼•å·
  // preserve ä¿ç•™ç”¨æˆ·è¾“å…¥çš„æƒ…å†µ
  quoteProps: 'preserve',

  // åœ¨jsxä¸­ä½¿ç”¨å•å¼•å·æ›¿æ¢åŒå¼•å·
  jsxSingleQuote: false,

  // è¡Œå°¾é€—å·,é»˜è®¤es5,å¯é€‰ none|es5|all
  // none æ²¡æœ‰è¡Œå°¾é€—å·
  // es5 åŒ…æ‹¬es5ä¸­çš„æ•°ç»„ã€å¯¹è±¡
  // all åŒ…æ‹¬å‡½æ•°å¯¹è±¡ç­‰æ‰€æœ‰å¯é€‰
  trailingComma: 'es5',

  // å¯¹è±¡ä¸­çš„ç©ºæ ¼ é»˜è®¤true
  // true: { foo: bar }
  // false: {foo: bar}
  bracketSpacing: true,

  // JSXæ ‡ç­¾é—­åˆä½ç½® é»˜è®¤false
  // false: <div
  //          className=""
  //          style={{}}
  //       >
  // true: <div
  //          className=""
  //          style={{}} >
  jsxBracketSameLine: false,

  //ç®­å¤´å‡½æ•°ä¸­çš„æ‹¬å·
  // â€œavoidâ€ - åœ¨æœ‰éœ€è¦çš„æ—¶å€™ä½¿ç”¨. Example: x => x
  // â€œalwaysâ€ - ä¸€ç›´ä½¿ç”¨. Example: (x) => x
  arrowParens: 'avoid',
};

```



æ‰€ä»¥æœ€ç»ˆ`package.json`ä¸­æ˜¯è¿™æ ·çš„

```javascript
// package.json
"husky": {
  "hooks": {
    "pre-commit": "lint-staged"
  }
},
"lint-staged": {
  "*.{js,jsx}": [
    "prettier --write",
    "eslint --cache --ext .js"
  ]
}
```



é…ç½®çš„æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æœ€åŸºæœ¬çš„ä»£ç æ£€æŸ¥ã€è‡ªåŠ¨æ ¼å¼ä»£ç åŠŸèƒ½å·²ç»éƒ½æœ‰äº†ã€‚